var
y          ${y}$            (long_name='output')
c          ${c}$            (long_name='private consumption good')
inv        ${i}$            (long_name='investment')
n          ${n}$            (long_name='labor')
wr         ${w^r}$          (long_name='real wage')
nxy        ${nx/y}$         (long_name='net export ratio')
s          ${s}$            (long_name='terms of trade')
pie        ${\pi}$          (long_name='inflation')
Wel        ${\mathcal{W}}$  (long_name='lifetime welfare')
br_y       ${br/y}$         (long_name='government debt to output ratio')
mr         ${m^r_t}$        (long_name='real money holdings')
invg       ${i^g}$          (long_name='government investment')
g          ${g}$            (long_name='public consumption good')
taun       ${\tau^k}$       (long_name='labor tax rate')
tauk       ${\tau^k}$       (long_name='capital tax rate')
k          ${k}$            (long_name='capital')
gamma_inv  ${\gamma}$       (long_name='growth rate of private investment')
q          ${q}$            (long_name='Lagrange multiplier capital accumulation constraint (Tobins marginal q)')
rrk        ${r^k/p}$        (long_name='real rental rate of capital')
z          ${z}$            (long_name='capital utilization rate')
uc         ${U_c}$          (long_name='marginal utility wrt private consumption')
um         ${U_m}$          (long_name='marginal utility wrt real money balances')
un         ${U_n}$          (long_name='marginal utility wrt labor supply')
r          ${r}$            (long_name='nominal interest rate')
mcr        ${mc^r}$         (long_name='real marginal costs')
br         ${b^r}$          (long_name='government bonds')
fr         ${f^r}$          (long_name='real value of net foreign assets')
pid        ${\pi^d}$        (long_name='domestic good inflation')
dner       ${\Delta e_t}$   (long_name='change nominal exchange rate')
Upsilon_p  ${\Upsilon^p}$   (long_name='price dispersion')
p1         ${p_1}$          (long_name='auxiliary variable 1 in recursive pricing equation')
p2         ${p_2}$          (long_name='auxiliary variable 2 in recursive pricing equation')
cg_y       ${(c+g)/y}$      (long_name='total consumption to output ratio')
mr_y       ${m^r/y}$        (long_name='money to output ratio')
piw        ${\pi^w}$        (long_name='wage inflation')
Upsilon_w  ${\Upsilon^w}$   (long_name='wage dispersion')
w1         ${w_1}$          (long_name='auxiliary variable 1 in recursive wage equation')
w2         ${w_2}$          (long_name='auxiliary variable 2 in recursive wage equation')
nu         ${\nu}$          (long_name='Edgeworth elasticity in total consumption bundle')
delta      ${\delta}$       (long_name='capital depreciation rate')
tax        ${tax}$          (long_name='total tax income')
invinvg_y  ${(i+i^g)/y}$    (long_name='total investment to output ratio')
war        ${\Delta}$       (long_name='war indicator')
a          ${a}$            (long_name='total factor productivity')
zeta       ${\zeta}$        (long_name='investment-specific productivity')
ys         ${y^*}$          (long_name='foreign demand')
s_taun     ${s^{\tau^n}}$   (long_name='labor tax shock')
s_tauk     ${s^{\tau^k}}$   (long_name='capital tax shock')
s_g        ${s^{g}}$        (long_name='government spending shock')
gm         $g_m$            (long_name='money growth rate')
yerr
;

varexo
eps_a     ${\varepsilon^{a}}$       (long_name='innovation to total factor productivity')
eps_g     ${\varepsilon^{g}}$       (long_name='innovation to government spending')
eps_ys    ${\varepsilon^{y^*}}$     (long_name='innovation to foreign demand')
eps_m     ${\varepsilon^{m}}$       (long_name='innovation to monetary growth rule')
eps_zeta  ${\varepsilon^{\zeta}}$   (long_name='innovation to investment-specific productivity')
eps_yerr  ${\varepsilon^{y^{ME}}}$  (long_name='innovation to output measurement error')
eps_taun  ${\varepsilon^{\tau^n}}$  (long_name='innovation to labor tax shock')
eps_tauk  ${\varepsilon^{\tau^k}}$  (long_name='innovation to capital tax shock')
eps_war   ${\varepsilon^{\Delta}}$  (long_name='innovation to war indicator')
;

parameters
BETA        ${\beta}$          (long_name='discount factor')
DELTA       ${\delta}$         (long_name='capital depreciation rate in normal times')
PHIINV      ${\phi_i}$         (long_name='investment adjustment cost parameter')
PSI         ${\psi}$           (long_name='inverse Frisch elasticity of labor supply')
NUWAR       ${\nu_{war}}$      (long_name='Edgeworth elasticity in total consumption bundle in war times')
NUNORM      ${\nu_{norm}}$     (long_name='Edgeworth elasticity in total consumption bundle in normal times')
ETAP        ${\eta_p}$         (long_name='Calvo probability intermediate goods')
ETAW        ${\eta_w}$         (long_name='Calvo probability labor supply')
CHIN        ${\chi_n}$         (long_name='utility weight wrt to labor')
CHIM        ${\chi_m}$         (long_name='utility weight wrt to money')
SIGMAC      ${\sigma_c}$       (long_name='risk aversion wrt total consumption')
SIGMAM      ${\sigma_m}$       (long_name='risk aversion wrt real money balances')
TAUN        ${\bar{\tau}_n}$   (long_name='labor tax rate target')
TAUK        ${\bar{\tau}_k}$   (long_name='capital tax rate target')
PHIZ        ${\phi_z}$         (long_name='capital utilization adjustment cost parameter')
IOTA        ${\iota}$          (long_name='capital productivity in production')
THETAP      ${\theta_p}$       (long_name='elasticity of substitution between differentiated goods')
GAMMAP      ${\gamma_p}$       (long_name='price inflation indexation')
THETAW      ${\theta_w}$       (long_name='elasticity of substitution between differentiated labor')
GAMMAW      ${\gamma_w}$       (long_name='wage inflation indexation')
PHIF        ${\phi_f}$         (long_name='foreign bond adjustment cost parameter')
g_y_SS      ${g/y}$            (long_name='target for steady-state government spending to output ratio')
invg_y_SS   ${i^g/y}$          (long_name='target for steady-state government investment to output ratio')
fr_y_SS     ${f^r/y}$          (long_name='target for net foreign assets to output ratio')
ALPHA       ${\alpha}$         (long_name='home bias in international bundles')
MU          ${\mu}$            (long_name='trade elasticity')
PWAR_L      ${p^l}$            (long_name='war spillover on labor (military draft)')
PWAR_B      ${p^b}$            (long_name='war spillover on government bonds (partial debt default)')
PWAR_DELTA  ${p^\delta}$       (long_name='war spillover on capital depreciation (capital destruction)')
DTAUN       ${d_{tau^n}}$      (long_name='feedback to government debt in labor tax rule')
DTAUK       ${d_{tau^kn}}$     (long_name='feedback to government debt in capital tax rule')
DG          ${d_{tau^n}}$      (long_name='feedback to government debt in government spending rule')
VARPHI      ${\varphi}$        (long_name='weight of individual consumption in total consumption bundle')
RHOA        ${\rho_a}$         (long_name='persistence total factor productivity')
RHOG        ${\rho_g}$         (long_name='persistence total factor productivity')
RHOZETA     ${\rho_zeta}$      (long_name='persistence total factor productivity')
RHOYS       ${\rho_{y^*}}$     (long_name='persistence total factor productivity')
RHOTAUN     ${\rho_{\tau^n}}$  (long_name='persistence total factor productivity')
RHOTAUK     ${\rho_{\tau^k}}$  (long_name='persistence total factor productivity')
RHOM        ${\rho_m}$         (long_name='persistence total factor productivity')
RHOYERR     ${\rho_{ME}}$      (long_name='persistence total factor productivity')
PHIWARA     ${\phi_a}$         (long_name='war spillover common technology')
PHIWARG     ${\phi_g}$         (long_name='war spillover government spending')
PHIWARZETA  ${\phi_\zeta}$     (long_name='war spillover investment-specific technology')
PHIWARYS    ${\phi_{y^*}}$     (long_name='war spillover foreign demand')
PHIWARTAUN  ${\phi_{\tau^n}}$  (long_name='war spillover labor tax')
PHIWARTAUK  ${\phi_{\tau^k}}$  (long_name='war spillover capital tax')
PHIWARM     ${\phi_m}$         (long_name='war spillover money growth')
;

BETA       =                0.96;
DELTA      =                 0.1;
PHIINV     =    4.50154027840831;
PSI        =                 1.5;
NUWAR      =   0.380278605335966;
NUNORM     =   0.496210333400939;
ETAP       =   0.178446386234593;
ETAW       =    0.23930728548848;
CHIN       =   0.301879419660619;
CHIM       = 0.00631488781790608;
SIGMAC     =                 1.5;
SIGMAM     =                 1.5;
TAUN       =                 0.3;
TAUK       =                0.22;
PHIZ       =                0.15;
IOTA       =                0.36;
THETAP     =                   6;
GAMMAP     =                   0;
THETAW     =                   6;
GAMMAW     =                   0;
PHIF       =              0.0025;
g_y_SS     =              0.1346;
invg_y_SS  =              0.0253;
fr_y_SS    =                   0;
ALPHA      =                0.15;
MU         =    1.31619966341329;
PWAR_L     =   0.103197410544156;
PWAR_B     =  0.0508922394725682;
PWAR_DELTA =  0.0547678965827401;
DTAUN      =   0.140600501208892;
DTAUK      =  0.0929972819542866;
DG         =    0.13579052550115;
VARPHI     =   0.825616851517874;
RHOA       =   0.987550423152858;
RHOG       =   0.982191559944877;
RHOZETA    =    0.54408229188074;
RHOYS      =   0.640179345362276;
RHOTAUN    =   0.998943651996966;
RHOTAUK    =   0.960820486717002;
RHOM       =   0.130752598062902;
RHOYERR    =   0.151317416285467;
PHIWARA    = -0.0431255495878594;
PHIWARG    =                   0;
PHIWARZETA =                   0;
PHIWARYS   =  -0.885476685767374;
PHIWARTAUN =  -0.122035895619738;
PHIWARTAUK =   0.458009730411382;
PHIWARM    =                   0;

model;
#ctilde = ( VARPHI * c^((nu-1)/nu) + (1-VARPHI) * g^((nu-1)/nu) )^(nu/(nu-1)); // total consumption
#kg = invg_y_SS * (steady_state(y) / steady_state(delta)); // government capital stock

[name='recursive welfare (B.1)']
Wel = ( ctilde^(1-SIGMAC) / (1-SIGMAC) + CHIM * mr^(1-SIGMAM)/(1-SIGMAM) - CHIN * n^(1+PSI)/(1+PSI) ) + BETA*Wel(+1);
[name='law of motion Edgeworth elasticity in total consumption bundle (B.2)']
nu  = (1 - war) * NUNORM + war * NUWAR;
[name='marginal utility wrt private consumption (implicit from B.1)']
uc = ctilde^(-SIGMAC) * VARPHI * (c/ctilde)^(-1/nu);
[name='marginal utility wrt real money balances (implicit from B.1)']
um = CHIM * mr^(-SIGMAM);
[name='marginal utility wrt labor supply (implicit from B.1)']
un = -CHIN * n^PSI;
[name='optimality wrt domestic bonds (B.8)']
BETA * uc(+1) / uc * r * (1-war(+1)*PWAR_B) / pie(+1) = 1;
[name='optimality wrt foreign bonds (B.9)']
(dner(+1) * uc(+1) / uc) / ( pie(+1) * ( 1 + PHIF * (fr-fr_y_SS*steady_state(y)) ) ) = 1;
[name='optimality wrt money (B.10)']
um - uc * ( r * (1-war(+1)*PWAR_B) -1 ) / ( r * (1-war(+1)*PWAR_B) ) = 0;
[name='optimality wrt capital (B.14)']
BETA * (uc(+1)/uc) * ( q(+1) * (1-delta(+1)) + (1-tauk(+1)) * rrk(+1)*z(+1) - (PHIZ/2) * (z(+1)-1)^2 + tauk(+1)*delta(+1) ) = q;
[name='optimality wrt investment (B.15)']
q * zeta * ( 1 - PHIINV/2*gamma_inv^2 - PHIINV*gamma_inv*(1+gamma_inv) ) + BETA * (uc(+1)/uc) * q(+1) * zeta(+1) * PHIINV * gamma_inv(+1) * (1+gamma_inv(+1))^2 = 1;
[name='growth rate of private investment (below B.16)']
gamma_inv = inv/inv(-1) - 1;
[name='optimality wrt capital utilization (B.16)']
(1-tauk) * rrk - PHIZ * (z-1) = 0;
[name='capital accumulation law of motion (B.6)']
k = (1-delta) * k(-1) + zeta * (1-PHIINV/2*gamma_inv^2) * inv;
[name='optimal factor input, capital to labor ratio (B.23)']
k(-1) = (IOTA*wr*n) / ((1-IOTA)*z*rrk);
[name='marginal costs (B.24)']
( (1-IOTA) * (1-war*PWAR_L) + IOTA ) * rrk^IOTA * wr^(1-IOTA) = a * IOTA^IOTA * ( (1-IOTA) * (1-war*PWAR_L) )^(1-IOTA) * mcr;
[name='aggregate supply (B.42)']
y * Upsilon_p = a * (z*k(-1))^IOTA * (Upsilon_w*n*(1-war*PWAR_L))^(1-IOTA);
[name='optimal reset wage law of motion (B.13)']
ETAW * (piw * pie(-1)^(-GAMMAW))^(THETAW-1) + (1-ETAW) * (w1/w2)^(1-THETAW) = 1;
[name='recursive wage setting auxiliary sum 1']
w1 = BETA * ETAW * w1(+1) * piw(+1)^(1+THETAW) / pie(+1) + (THETAW/(THETAW-1)) * (-un/uc) / ((1-taun)*wr);
[name='recursive wage setting auxiliary sum 2']
w2 = BETA * ETAW * w2(+1) * piw(+1)^THETAW * pie^GAMMAW / pie(+1) + n;
[name='definition wage inflation']
wr/wr(-1) = piw/pie;
[name='wage efficiency distortion law of motion']
Upsilon_w = ETAW * Upsilon_w(-1) * (piw * pie(-1)^(-GAMMAW))^THETAW + (1-ETAW) * (w1/w2)^(-THETAW);
[name='optimal reset price law of motion (B.28)']
ETAP * (pid * pid(-1)^GAMMAP)^(THETAP-1) + (1-ETAP) * (p1/p2)^(1-THETAP) = 1;
[name='recursive price setting auxiliary sum 1']
p1 = BETA * ETAP * p1(+1) * pid(+1)^(1+THETAP) / pie(+1) + uc * y * (THETAP/(THETAP-1)) * mcr * (1 - ALPHA + ALPHA * s^(1-MU))^(1/(MU-1));
[name='recursive price setting auxiliary sum 2']
p2 = BETA * ETAP * p2(+1) * pid(+1)^THETAP * pid^GAMMAP / pie(+1) + uc * y;
[name='price efficiency distortion law of motion']
Upsilon_p = ETAP * Upsilon_p(-1) * (pid*pid(-1)^(-GAMMAP))^THETAP + (1-ETAP)*(p1/p2)^(-THETAP);
[name='fiscal rule public investment']
delta * kg = invg;
[name='definition money growth']
mr/mr(-1) = gm/pie;
[name='government budget']
br + (mr + (taun-war*PWAR_L)*wr*n + tauk*(rrk*z-delta)*k(-1))*(1-ALPHA+ALPHA*s^(1-MU))^(1/(1-MU)) = r(-1)*(1-war*PWAR_B)*br(-1)/pid + pie*mr(-1)/pid + g + invg - 0.25*(br(-1)-steady_state(br));
[name='law of motion CPI (B.18)']
pie = pid * ( (1-ALPHA+ALPHA*s^(1-MU)) / (1-ALPHA+ALPHA*s(-1)^(1-MU)) )^(1/(1-MU));
[name='definition terms of trade']
s/s(-1) = dner/pid;
[name='aggregate demand']
y = (1-ALPHA) * ( c + inv + PHIF/2*(fr-fr_y_SS*steady_state(y))^2 + PHIZ/2*k(-1)*(z-1)^2 ) * (1-ALPHA+ALPHA*s^(1-MU))^(MU/(1-MU)) + ALPHA * ys * (ALPHA+(1-ALPHA)*s^(1-MU))^(MU/(1-MU)) + g + invg;
[name='net foreign asset position']
fr - dner*fr(-1)/BETA/pie = nxy * y;
[name='net export ratio']
nxy = ( (1-ALPHA+ALPHA*s^(1-MU))^(1/(MU-1)) * ( y - g - invg ) - (c + inv + (PHIF/2) * (fr-fr_y_SS*steady_state(y))^2 + (PHIZ/2)*k(-1)*(z-1)^2) ) / y;
[name='law of motion common productivity']
a = (1-RHOA) + RHOA * a(-1) + eps_a + PHIWARA * war;
[name='law of motion investment-specific productivity']
zeta = (1-RHOZETA) + RHOZETA * zeta(-1) + eps_zeta + PHIWARZETA * war;
[name='law of motion foreign demand']
ys = (1-RHOYS) * steady_state(y) * (1 - g_y_SS - invg_y_SS) + RHOYS * ys(-1) + eps_ys + PHIWARYS * war;
[name='fiscal rule government spending']
g = g_y_SS * steady_state(y) - DG * (br(-1)-steady_state(br)) + PHIWARG * war + s_g;
[name='government spending shock']
s_g = RHOG * s_g(-1) + eps_g;
[name='law of motion capital depreciation rate']
delta = DELTA * (1 + war * PWAR_DELTA);
[name='fiscal rule labor taxes']
taun = TAUN + DTAUN * (br(-1)-steady_state(br)) + PHIWARTAUN * war + s_taun;
[name='labor tax shock']
s_taun = RHOTAUN * s_taun(-1) + eps_taun;
[name='fiscal rule capital taxes']
tauk = TAUK + DTAUK * (br(-1)-steady_state(br)) + PHIWARTAUK * war + s_tauk;
[name='capital tax shock']
s_tauk = RHOTAUK * s_tauk(-1) + eps_tauk;
[name='monetary growth rate rule']
gm = (1 - RHOM) + RHOM * gm(-1) + eps_m + PHIWARM * war;
[name='output measurement error']
yerr = RHOYERR * yerr(-1) + eps_yerr;
[name='war shock']
war = eps_war;
[name='tax income']
tax = ((taun*wr*n + tauk*(rrk*z-delta)*k(-1))*(1-ALPHA+ALPHA*s^(1-MU))^(1/(1-MU)));
[name='total consumption over output ratio']
cg_y = (c + g)/y;
[name='government bonds over output ratio']
br_y = br / y;
[name='money over output ratio']
mr_y = mr / y;
[name='total investment over output ratio']
invinvg_y = (inv + invg)/y;
end;

initval;
war = 0;
yerr = 0;
nu = NUNORM;
delta = DELTA;
taun = TAUN;
tauk = TAUK;
gamma_inv = 0;
a = 1;
zeta = 1;
q = 1;
pie = 1;
pid = 1;
piw = 1;
s = 1;
dner = 1;
Upsilon_p = 1;
Upsilon_w = 1;
gm = 1;
r = 1/BETA;
z = 1.6111;
rrk = 0.11751;
wr = 0.90355;
n = 1;
c = 1.0796;
k = 2.6846;
y = 1.6942;
g = g_y_SS*y;
invg = invg_y_SS*y;
ys = (1-g_y_SS-invg_y_SS)*y;
inv = delta*k;
mr = 0.25 * y;
uc = ((VARPHI*c^((nu-1)/nu)+(1-VARPHI)*g^((nu-1)/nu))^(nu/(nu-1)))^(1-SIGMAC)*VARPHI*c^((nu-1)/nu)/c/(VARPHI*c^((nu-1)/nu)+(1-VARPHI)*g^((nu-1)/nu));
un = -CHIN;
um = CHIM * mr^(-SIGMAM);
mcr = (THETAP-1)/THETAP;
br = (taun*wr*n + tauk*rrk*z*k - g - invg - tauk*delta*k) /(1/BETA-1);
fr = fr_y_SS*y;
nxy = 0;
p1 = (uc*y*mcr*THETAP/(THETAP-1))/(1-BETA*ETAP);
p2 = uc*y/(1-BETA*ETAP);
w1 = ((THETAW/(THETAW-1))*(-un/uc)/((1-taun)*wr))/(1 - BETA*ETAW);
w2 = 1 / (1 - BETA*ETAW);
cg_y = (c+g)/y;
br_y = br/y;
mr_y = mr/y;
tax = ((taun*wr*n + tauk*(rrk*z-delta)*k)*(1-ALPHA+ALPHA*s^(1-MU))^(1/(1-MU)));
invinvg_y = (inv + invg)/y;
Wel = (((VARPHI * c^((nu-1)/nu) + (1-VARPHI) * g^((nu-1)/nu))^(nu/(nu-1)))^(1-SIGMAC)/(1-SIGMAC) + CHIM * mr^(1-SIGMAM)/(1-SIGMAM) - CHIN * n^(1+PSI)/(1+PSI)) / (1 - BETA);
end;
steady;
check;
model_diagnostics;

